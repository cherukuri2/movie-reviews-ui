<mat-toolbar color="primary" class="elev">
  <span class="title">ðŸŽ¬ Movie Reviews (AI) - Â© Copyright: Rajasekhar Cherukuri</span>
  <span class="spacer"></span>
  <span class="subtitle">Find the film â€¢ Get a quick review</span>
</mat-toolbar>

<div class="page">
  <mat-card class="search-card">
    <mat-card-header>
      <mat-card-title>Describe the movie</mat-card-title>
      <mat-card-subtitle>
        Type a title, plot fragments, actors, quotes, vibesâ€¦ weâ€™ll guess the movie(s) and generate a short review.
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="submit()" class="form-grid">
        <mat-form-field appearance="outline" class="full">
          <mat-label>Prompt</mat-label>
          <textarea
            matInput
            formControlName="prompt"
            rows="5"
            cdkTextareaAutosize
            cdkAutosizeMinRows="5"
            cdkAutosizeMaxRows="12"
            placeholder="e.g., Dream heist with a spinning top endingâ€¦">
          </textarea>
          <mat-hint align="start">Be as specific as you canâ€”actors, quotes, scenes help.</mat-hint>
          <mat-error *ngIf="form.get('prompt')?.hasError('required')">Prompt is required</mat-error>
          <mat-error *ngIf="form.get('prompt')?.hasError('minlength')">At least 3 characters</mat-error>
        </mat-form-field>

        <div class="row-2">
          <mat-form-field appearance="outline" class="half">
            <mat-label>Provider</mat-label>
            <mat-select formControlName="provider">
              <mat-option value="openai">OpenAI (hosted)</mat-option>
              <mat-option value="ollama">Ollama (local)</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half">
            <mat-label>Model</mat-label>
            <input matInput formControlName="model" placeholder="gpt-4o-mini or llama3.1" />
          </mat-form-field>
        </div>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          class="submit-btn"
          [disabled]="svc.loading || form.invalid"
          matTooltip="Search and generate reviews">
          <mat-icon>search</mat-icon>
          <span>Search & Review</span>
        </button>
      </form>

      <mat-progress-bar *ngIf="svc.loading" mode="indeterminate"></mat-progress-bar>
      <mat-card *ngIf="error" class="error-card" color="warn">
        <mat-card-content class="error-content">
          <mat-icon color="warn">error</mat-icon>
          <span>{{ error }}</span>
        </mat-card-content>
      </mat-card>
    </mat-card-content>
  </mat-card>

  <section *ngIf="result as r" class="results">
    <div class="results-header">
      <h2>Results</h2>
      <mat-chip-set>
        <mat-chip appearance="outlined" color="primary">Provider: {{ r.provider }}</mat-chip>
        <mat-chip appearance="outlined" color="primary">Model: {{ r.model }}</mat-chip>
      </mat-chip-set>
    </div>

    <mat-card *ngIf="!r.matches?.length" class="empty-card">
      <mat-card-content>No confident matches. Try adding actors, quotes, or a key scene.</mat-card-content>
    </mat-card>

    <div class="cards">
      <mat-card class="match" *ngFor="let m of r.matches">
        <mat-card-header>
          <mat-card-title>
            {{ m.title }}
            <span class="year" *ngIf="m.year">({{ m.year }})</span>
          </mat-card-title>
        </mat-card-header>

        <mat-card-content>
          <p class="synopsis"><strong>Synopsis:</strong> {{ m.synopsis }}</p>
          <mat-divider></mat-divider>
          <p class="review"><strong>Review:</strong> {{ m.review }}</p>

          <div class="meta" *ngIf="m.confidence != null">
            <mat-chip-set>
              <mat-chip color="primary" appearance="outlined">
                Confidence: {{ m.confidence | number:'1.0-2' }}
              </mat-chip>
            </mat-chip-set>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </section>
</div>
